packages:
  yum:
    # Dependências básicas do sistema
    wget: []
    unzip: []
    git: []
    convmv: []

commands:
  01_create_temp_dir:
    command: "mkdir -p /var/app/temp && chmod -R 777 /var/app/temp && chown -R webapp:webapp /var/app/temp"
    ignoreErrors: true
  
  02_install_dotnet_tools:
    command: |
      export PATH="$PATH:/usr/local/bin"
    ignoreErrors: true

container_commands:
  01_verify_installation:
    command: |
      echo "Verificando instalação..."
      dotnet --version || echo "Dotnet não encontrado"
      echo "Verificação concluída"
    leader_only: true
    ignoreErrors: true

  02_fix_temp_permissions:
    command: |
      echo "Configurando permissões do diretório temp..."
      mkdir -p /var/app/temp
      chmod -R 777 /var/app/temp
      chown -R webapp:webapp /var/app/temp || chown -R root:root /var/app/temp
      echo "Permissões configuradas"
    leader_only: true
    ignoreErrors: true

  03_fix_filenames_simple:
    command: |
      echo "Corrigindo nomes de arquivos..."
      if [ -d "/var/app/current/Docs" ]; then
        echo "Aplicando convmv na pasta Docs..."
        convmv -f latin1 -t utf-8 --notest --replace /var/app/current/Docs/
        echo "Verificando resultado..."
        ls -la /var/app/current/Docs/
      fi
    leader_only: true
    ignoreErrors: true

option_settings:
  aws:elasticbeanstalk:environment:
    EnvironmentType: "SingleInstance"
  
  aws:autoscaling:launchconfiguration:
    InstanceType: "t3.small"
  
  aws:elasticbeanstalk:application:environment:
    ASPNETCORE_ENVIRONMENT: "Production"
    DOTNET_SYSTEM_GLOBALIZATION_INVARIANT: "0"
    DOTNET_RUNNING_IN_CONTAINER: "true"
    DOTNET_USE_POLLING_FILE_WATCHER: "true"
    Parquet__TempFolder: "/var/app/temp"
    LANG: "pt_BR.UTF-8"
    LC_ALL: "pt_BR.UTF-8" 